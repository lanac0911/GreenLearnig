{"cells":[{"cell_type":"code","source":["!pip install pandas\n","!pip install pywavelets"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"2vGZViyQdPd0","executionInfo":{"status":"ok","timestamp":1697863436132,"user_tz":-480,"elapsed":20065,"user":{"displayName":"DiYu Chang","userId":"14715348963524571190"}},"outputId":"9dc48876-1dc3-4eb9-ee2c-8932714017f1"},"id":"2vGZViyQdPd0","execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: pandas in /usr/local/lib/python3.10/dist-packages (1.5.3)\n","Requirement already satisfied: python-dateutil>=2.8.1 in /usr/local/lib/python3.10/dist-packages (from pandas) (2.8.2)\n","Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas) (2023.3.post1)\n","Requirement already satisfied: numpy>=1.21.0 in /usr/local/lib/python3.10/dist-packages (from pandas) (1.23.5)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil>=2.8.1->pandas) (1.16.0)\n","Requirement already satisfied: pywavelets in /usr/local/lib/python3.10/dist-packages (1.4.1)\n","Requirement already satisfied: numpy>=1.17.3 in /usr/local/lib/python3.10/dist-packages (from pywavelets) (1.23.5)\n"]}]},{"cell_type":"markdown","source":["# 新增區段"],"metadata":{"id":"EgIHIPfVnbLx"},"id":"EgIHIPfVnbLx"},{"cell_type":"code","source":["from google.colab import drive\n","drive.mount('/content/drive')"],"metadata":{"id":"NtDKv0b2J1i7","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1699457110633,"user_tz":-480,"elapsed":16487,"user":{"displayName":"DiYu Chang","userId":"14715348963524571190"}},"outputId":"9fdf22a2-fbb8-4213-9209-eef7a5083723"},"id":"NtDKv0b2J1i7","execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}]},{"cell_type":"code","execution_count":7,"id":"5f595c72-5528-4f67-84a1-c3d464e0ce69","metadata":{"id":"5f595c72-5528-4f67-84a1-c3d464e0ce69","executionInfo":{"status":"ok","timestamp":1699457399845,"user_tz":-480,"elapsed":377,"user":{"displayName":"DiYu Chang","userId":"14715348963524571190"}}},"outputs":[],"source":["# %load cwt.py\n","import pandas as pd\n","import numpy as np\n","import pywt\n","import matplotlib.pyplot as plt\n","import os\n","import matplotlib.pyplot as plt\n"]},{"cell_type":"code","source":["target = 'MHE'\n","drive_path = \"/content/drive/MyDrive/GL/CWT/\"\n","sliced_len = 500\n","\n","# 读取CSV文件\n","data = pd.read_csv(drive_path + f\"Electricity_{target}.csv\")\n","\n","# 将数据切割成1000行一次的片段\n","sliced_data = [data[i:i+1000] for i in range(0, len(data), sliced_len)]\n","\n","# --------------------------\n","# 获取当前工作目录\n","# current_directory = os.getcwd()\n","# 拼接要检查的目录路径\n","# cwt_result_directory = os.path.join(current_directory, 'cwt_result')\n","# 检查目录是否存在，如果不存在则创建它\n","# if not os.path.exists(cwt_result_directory):\n","    # os.makedirs(cwt_result_directory)\n","\n","# 创建一个目录来存储图像\n","image_dir = drive_path + f'cwt_{target}_result'  # 设置图像目录\n","if not os.path.exists(image_dir):\n","    os.makedirs(image_dir)\n","#---------------------\n","\n","\n"],"metadata":{"id":"tiGXbYjEencH","executionInfo":{"status":"ok","timestamp":1699457403795,"user_tz":-480,"elapsed":1872,"user":{"displayName":"DiYu Chang","userId":"14715348963524571190"}}},"id":"tiGXbYjEencH","execution_count":8,"outputs":[]},{"cell_type":"code","source":["# 选择母小波函数（这里选择 Morlet 小波）\n","wavelet = 'morl'\n","level = 5\n","feature = 'P'\n","\n","# 循环处理每个数据片段\n","for idx, chunk in enumerate(sliced_data):\n","    # 获取所需的列数据，假设您需要处理的是前三列\n","    current_signal = chunk[feature].values\n","    # I = chunk['I'].values\n","    # f = chunk['f'].values\n","\n","    # 设置尺度参数\n","    scales = np.arange(1, 128)  # 这里选择了一个简单的尺度范围\n","\n","    # 执行CWT转换\n","    coeffs, freqs = pywt.cwt(current_signal, scales, wavelet, 1)\n","\n","# ------------------\n","\n","    # 创建图像\n","    plt.figure(figsize=(6, 6))\n","    plt.imshow(abs(coeffs), aspect='auto', cmap='jet', origin='lower', extent=[0, len(data), 1, 31])\n","    plt.axis('off')\n","\n","    # 保存图像\n","    # image_filename = f'cwt_result/image_{idx}.png'\n","    image_filename = os.path.join(image_dir, f'{target}_{idx}.png')\n","    # plt.savefig(f'/content/drive/MyDrive/GL/CWT/BME_CWT_result.png', bbox_inches='tight', pad_inches=0)\n","    plt.savefig(image_filename, bbox_inches='tight', pad_inches=0)\n","    # 关闭图像\n","    plt.close()\n","\n","\n","print(\"图像处理完成\")\n","plt.show()\n","\n","txt_filename = os.path.join(image_dir, f'{target}info.txt')\n","# 打开一个文本文件（如果文件不存在，将创建一个新文件）\n","with open(txt_filename, \"w\") as file:\n","    # 在文件中写入文本内容\n","    file.write(f\"文件：Electricity_{target}.csv\\n\")\n","    file.write(f\"擷取特徵：{feature}\\n\")\n","    file.write(f\"筆數{len(sliced_data)}\\n\")\n","\n","# 文件会在退出\"with\"代码块时自动关闭\n"],"metadata":{"id":"7pfR3TUqhbCf","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1699457915216,"user_tz":-480,"elapsed":507762,"user":{"displayName":"DiYu Chang","userId":"14715348963524571190"}},"outputId":"a189e2a3-5d6c-472a-f6dd-d3dfbf5c1007"},"id":"7pfR3TUqhbCf","execution_count":9,"outputs":[{"output_type":"stream","name":"stdout","text":["图像处理完成\n"]}]}],"metadata":{"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.11.4"},"colab":{"provenance":[],"gpuType":"T4"},"accelerator":"GPU"},"nbformat":4,"nbformat_minor":5}